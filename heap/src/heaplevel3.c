#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <stdlib.h>

void secret(){

printf("\033[1m\nCongrats!\n\n\x1b[0m");
exit(0);

}

struct device{
    
    int (*func1)();
    int (*func2)();
    int (*func3)();
    int (*func4)();
    char a[32];
};

void func1(){
    printf("Test 1 succeeded.\n");
}
void func2(){
    printf("Test 2 succeeded.\n");
}
void func3(){
    printf("Test 3 succeeded.\n");
}
void func4(){
    printf("Test 4 succeeded.\n");
}

int main(){
    
    struct device *_device;
    char *str;
    
    printf("\nWelcome to HeapLevel3!\nCreated by \033[1m@bellis1000\x1b[0m\n\n");
    
    while (1){
        printf("[1] Allocate string\n[2] Free string\n[3] Allocate device\n[4] Free device\n[5] Verify device\n[6] Quit\n");
        int choice;
        scanf("%d",&choice);
        
        switch (choice){
            case 1:
                
                // allocate string
                printf("Enter characters:\n");
                char data[64];
                scanf("%63s",data);
                str = malloc(256);
                strncpy(str,data,64);
                
                // DEBUG
                
                printf("String is at %p\n",str);
                
                break;
            case 2:
                
                // free string
                free(str);
                
                break;
            case 3:
                
                // allocate device
                _device = malloc(256);
                _device->func1 = func1;
                _device->func2 = func2;
                _device->func3 = func3;
                _device->func4 = func4;
                
                printf("Device is at %p\n",_device);
                
                break;
            case 4:
                
                // free device
                if (_device){
                    free(_device);
                    _device = NULL;
                }else{
                    printf("No device active.\n");
                }
                
                break;
            case 5:
                
                // verify device
                if (_device){
                    _device->func1();
                    _device->func2();
                    _device->func3();
                    _device->func4();
                }else{
                    printf("No device active.\n");
                }
                
                break;
            case 6:
                
                // quit
                exit(0);
                
                break;
            default:
                printf("Invalid option.\n");
                break;
        }
    }
    
    return 0;
}
